services:
  - type: web
    name: govt-job-rag
    env: python
    plan: free
    region: oregon
    buildCommand: pip install --upgrade pip setuptools wheel && pip install -r requirements.txt
    startCommand: uvicorn api_server:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: PYTHONUNBUFFERED
        value: "1"
      - key: HF_HUB_DISABLE_SYMLINKS_WARNING
        value: "1"
      # In-memory Chroma (no persistence): set false
      - key: RAG_PERSIST
        value: "false"
      # Optional caches to avoid symlink warnings and write to ephemeral storage
      - key: HF_HOME
        value: "/tmp"
      - key: SENTENCE_TRANSFORMERS_HOME
        value: "/tmp"
      - key: WEB_CONCURRENCY
        value: "1"
      # For /tmp persistence between requests on same instance (no attached disk), set:
      # - key: RAG_PERSIST
      #   value: "true"
      # - key: VECTOR_DB_PATH
      #   value: "/tmp/chroma_db"

